const scriptName = "ì‹ ì²­t";
const enteru = "â€‹".repeat(500);
const FS = FileStream;
const grade = 2;
const pathmain = '/sdcard/messengerbot/dshs/userprofile.txt';
importClass(org.jsoup.Jsoup);
if (!FS.read(pathmain)) 
  FS.write(pathmain, JSON.stringify({}, null, 3));
function response(room, msg, sender, isGroupChat, replier, ImageDB) {
  if (isGroupChat == false) {
    try {
      if (msg == "ì´ˆê¸°í™”") {
        FS.write(pathmain, JSON.stringify({}, null, 3));
        replier.reply("ì´ˆê¸°í™”ê°€ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤. ê³„ì •ë“±ë¡ ëª…ë ¹ì–´ë¡œ ê³„ì •ì„ ë“±ë¡í•˜ì‹¤ ìˆ˜ ìˆìŠµë‹ˆë‹¤.");
      } else if (msg.startsWith("ê³„ì •ë“±ë¡")) {
        if (getUserRegistered()) 
          replier.reply("ì´ë¯¸ ê³„ì •ì •ë³´ê°€ ë“±ë¡ë˜ì–´ ìˆìŠµë‹ˆë‹¤. ì´ˆê¸°í™” í•˜ì‹œë ¤ë©´ ì´ˆê¸°í™” ë¥¼ ì…ë ¥í•˜ì„¸ìš”.");
        else if (msg.split(" ").length <= 2) 
          replier.reply("ì˜ëª»ëœ ì…ë ¥ì…ë‹ˆë‹¤. ë‹¤ì‹œ ì…ë ¥í•´ì£¼ì„¸ìš”.\n Ex) ê³„ì •ë“±ë¡ 20201500 password");
        else {
          var ID = msg.split(" ")[1].replace(/(|)/g, "");
          var PW = msg.split(" ")[2].replace(/(|)/g, "");
          var token = doLogin([ID, PW]);
          var name = getName(token);
          if (name == "") 
            replier.reply("â›” ë¡œê·¸ì¸ì„ ì‹¤íŒ¨í•˜ì˜€ìŠµë‹ˆë‹¤. ì•„ì´ë””ì™€ ë¹„ë°€ë²ˆí˜¸ë¥¼ ì •í™•í•˜ê²Œ ì…ë ¥í–ˆëŠ”ì§€ í™•ì¸í•´ì£¼ì„¸ìš”.");
          else {
            var temp = {
  "ID": ID, 
  "PW": PW, 
  "token": token};
            FS.write(pathmain, JSON.stringify(temp, null, 4));
            replier.reply(name + "ë‹˜ ë“±ë¡ ì™„ë£Œ!");
          }
        }
      } else if (!getUserRegistered()) 
        replier.reply("ë“±ë¡ëœ ê³„ì •ì •ë³´ê°€ ì—†ìŠµë‹ˆë‹¤.\nê³„ì •ë“±ë¡ (ì•„ì´ë””) (ë¹„ë°€ë²ˆí˜¸)ë¥¼ ì…ë ¥í•˜ì„¸ìš”.\nEx. ê³„ì •ë“±ë¡ 20201500 password");
      else {
        if(msg=="ë¶ˆ"){
          replier.reply(getWeekendDB(1));
        }
        if (msg == "ë¦¬ì…‹") {
          replier.reply("ì¬ë¡œê·¸ì¸ ì‹œë„ ì¤‘...");
          var info = getUserInfo();
          var ID = info[0];
          var PW = info[1];
          var temp = JSON.parse(FS.read(pathmain));
          temp.token = doLogin([ID, PW]);
          FS.write(pathmain, JSON.stringify(temp, null, 4));
          var name = getName(temp.token);
          replier.reply(name + "ë‹˜ ì¬ë¡œê·¸ì¸ ì™„ë£Œ!");
        } else if (msg == ("ììŠµìƒíƒœ") || msg == "ììŠµ ìƒíƒœ") {
          replier.reply("ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘..");
          replier.reply(doSelfStudyCheck(false, true));
        } else if (msg == ("ë²Œì ")) {
          replier.reply("ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘..");
          replier.reply(doPointCheck());
        } else if (msg == "ì£¼ë§ìƒíƒœ" || msg == "ì£¼ë§ ìƒíƒœ") {
          replier.reply("ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘..");
          replier.reply(doWeekendCheck(false, true));
        } else if ((msg == "ììŠµë²ˆí˜¸" || msg == "ììŠµ ë²ˆí˜¸")) {
          replier.reply("ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘..");
          replier.reply("'ììŠµì‹ ì²­'ì„ ì…ë ¥í•˜ê³ , êµì‹¤ì½”ë“œë¥¼ ì…ë ¥í•˜ì„¸ìš”." + enteru + "\n\n" + "ex)\n ììŠµì‹ ì²­ 1/2/3\n ììŠµì‹ ì²­ 1//3\n ììŠµì‹ ì²­ a12\n ììŠµì‹ ì²­ 12a\n -ì‹ ì²­í•˜ì§€ ì•Šì„ ììŠµì‹œê°„ì€ ë¹ˆì¹¸ìœ¼ë¡œ í•´ì£¼ì„¸ìš”.\n -ì·¨ì†Œí•˜ì‹¤ ììŠµì‹œê°„ì—ëŠ” 0ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.\n -ëª¨ë“  ììŠµì‹œê°„ì„ ê°™ì€ êµì‹¤ë¡œ ì‹ ì²­í•˜ì‹œë ¤ë©´ êµì‹¤ì½”ë“œë¥¼ í•˜ë‚˜ë§Œ ì ê³  aë‚˜ Aë¥¼ ê°™ì´ ì…ë ¥í•´ì£¼ì„¸ìš”.\n\n" + "ğŸ”´ë´‡ìœ¼ë¡œ ììŠµì‹ ì²­ì„ í•˜ì—¬ ë°œìƒí•œ ë¬¸ì œëŠ” ê°œë°œìê°€ ì±…ì„ì§€ì§€ ì•Šìœ¼ë©° ì‚¬ìš©ì ë³¸ì¸ì—ê²Œ ì±…ì„ì´ ìˆìŠµë‹ˆë‹¤.\n\n" + "====================\n\nã€Šêµì‹¤ ëª©ë¡ã€‹\n" + getRoomNumberList(0));
        } else if ((msg == "ììŠµì¸ì›") || (msg == "ììŠµ ì¸ì›")) {
          if (!getSelfStudyTime()) 
            replier.reply("â›” ììŠµì‹ ì²­ ì‹œê°„ì´ ì•„ë‹ˆë¯€ë¡œ í™•ì¸í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.\n(ì‹ ì²­ì‹œê°„: 08:00~18:30)");
          else {
            replier.reply("ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘.. (10ì´ˆ ì´ìƒ ì†Œìš”)");
            replier.reply("â„¹ììŠµì¥ì†Œ ì¸ì›í˜„í™©â„¹" + enteru + "\n\n" + doSelfStudyCheckNum());
          }
        } else if (msg.startsWith("ììŠµì‹ ì²­") || msg.startsWith("ììŠµ ì‹ ì²­")) {
          if (getWeekendTime()) 
            replier.reply("âš ï¸ì˜¤ëŠ˜ì€ ì£¼ë§ì…ë‹ˆë‹¤. ì£¼ë§ì‹ ì²­ì„ í•´ì£¼ì‹œê¸° ë°”ëë‹ˆë‹¤.");
          else if (!getSelfStudyTime()) 
            replier.reply("â›” ììŠµì‹ ì²­ ì‹œê°„ì´ ì•„ë‹™ë‹ˆë‹¤.\n(ì‹ ì²­ì‹œê°„: 08:00~18:30)");
          else {
            if (msg.indexOf("A") != -1 || msg.indexOf("a") != -1) {
              replier.reply("ì‹ ì²­í•˜ëŠ” ì¤‘...\n(âš ï¸ì‹ ì²­ì´ ëë‚˜ê¸° ì „ê¹Œì§€ ììŠµì‹ ì²­ì„ ì ˆëŒ€ ì¬ì‹œë„ í•˜ì§€ ë§ì•„ì£¼ì„¸ìš”.)\nğŸ”´ë´‡ìœ¼ë¡œ ììŠµì‹ ì²­ì„ í•˜ì—¬ ë°œìƒí•œ ë¬¸ì œëŠ” ê°œë°œìê°€ ì±…ì„ì§€ì§€ ì•Šìœ¼ë©° ì‚¬ìš©ì ë³¸ì¸ì—ê²Œ ì±…ì„ì´ ìˆìŠµë‹ˆë‹¤.");
              var info = doSelfStudyCheck(true, false);
              var tp = msg.substr(5).replace(/A|a/g, "");
              var apply = [tp, tp, tp];
              apply = doSelfStudyConvert(apply);
              for (var i = 0; i < 3; i++) {
                if (apply[i] == "") 
                  continue;
                if (info[i] != "") 
                  doSelfStudySubmit(apply[i], i + 1, info[i]);
                if (apply[i] != "delete") 
                  doSelfStudySubmit(apply[i], i + 1, "save");
              }
              replier.reply("ì‹ ì²­ ì™„ë£Œ!\n\n" + doSelfStudyCheck(false, true));
            } else if (msg.substr(6).split("/")[2] == undefined) 
              replier.reply("ì…ë ¥ì´ ì˜ëª»ë˜ì—ˆëŠ”ì§€ í™•ì¸ í›„ ë‹¤ì‹œ ì…ë ¥í•´ì£¼ì„¸ìš”.");
            else {
              replier.reply("ì‹ ì²­í•˜ëŠ” ì¤‘...\n(âš ï¸ì‹ ì²­ì´ ëë‚˜ê¸° ì „ê¹Œì§€ ììŠµì‹ ì²­ì„ ì ˆëŒ€ ì¬ì‹œë„ í•˜ì§€ ë§ì•„ì£¼ì„¸ìš”.)\nğŸ”´ë´‡ìœ¼ë¡œ ììŠµì‹ ì²­ì„ í•˜ì—¬ ë°œìƒí•œ ë¬¸ì œëŠ” ê°œë°œìê°€ ì±…ì„ì§€ì§€ ì•Šìœ¼ë©° ì‚¬ìš©ì ë³¸ì¸ì—ê²Œ ì±…ì„ì´ ìˆìŠµë‹ˆë‹¤.");
              var info = doSelfStudyCheck(true, false);
              var apply = msg.substr(6).split("/");
              if (apply[0] == apply[1] && apply[1] == apply[2]) {
                replier.reply("[íŒ] ììŠµì‹ ì²­ " + apply[1] + "a ë¡œ ì…ë ¥í•˜ì‹œë©´ ë” í¸í•˜ê²Œ ì‹ ì²­í•˜ì‹¤ ìˆ˜ ìˆìŠµë‹ˆë‹¤!");
              }
              apply = doSelfStudyConvert(apply);
              for (var i = 0; i < 3; i++) {
                if (apply[i] == "") 
                  continue;
                if (info[i] != "") 
                  doSelfStudySubmit(apply[i], i + 1, info[i]);
                if (apply[i] != "delete") 
                  doSelfStudySubmit(apply[i], i + 1, "save");
              }
              replier.reply("ì‹ ì²­ ì™„ë£Œ!\n\n" + doSelfStudyCheck(false, true));
            }
          }
        } else if ((msg == "ì£¼ë§ë²ˆí˜¸" || msg == "ì£¼ë§ ë²ˆí˜¸")) {
          replier.reply("ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘..");
          var number = getUserInfo()[0];
          var sinfoa = "[[í† ìš”ì¼]]\nã€Šì‹œê°„í‘œ(8)ã€‹\n (1)ì˜¤ì „ììœ¨   09:00 ~ 12:00\n (2)ê¿ˆì§€ë½      13:00 ~ 16:20\n (3)ì˜¤í›„ììœ¨1 13:00 ~ 14:40\n (4)ì˜¤í›„ììœ¨2 14:50 ~ 16:20\n (5)ì˜¤í›„ììœ¨3 16:30 ~ 18:00\n (6)ì•¼ê°„ììœ¨1 19:30 ~ 21:00\n (7)ì•¼ê°„ììœ¨2 21:30 ~ 22:30\n (8)ì•¼ê°„ììœ¨3 22:40 ~ 23:40\n\nã€Šêµì‹¤ ëª©ë¡ã€‹\n";
          var sinfob = "[[ì¼ìš”ì¼]]\nã€Šì‹œê°„í‘œ(7)ã€‹\n (1)ì˜¤ì „ììœ¨   09:00 ~ 12:00\n (2)ì˜¤í›„ììœ¨1 13:00 ~ 14:40\n (3)ì˜¤í›„ììœ¨2 14:50 ~ 16:20\n (4)ì˜¤í›„ììœ¨3 16:30 ~ 18:00\n (5)ì•¼ê°„ììœ¨1 19:30 ~ 21:00\n (6)ì•¼ê°„ììœ¨2 21:30 ~ 22:40\n (7)ì•¼ê°„ììœ¨3 22:40 ~ 23:40\n\nã€Šêµì‹¤ ëª©ë¡ã€‹\n";
          var iinfo = getRoomNumberList(1);
          var iiinfo = getRoomNumberList(2);
          replier.reply("'ì£¼ë§ì‹ ì²­'ì„ ì…ë ¥í•˜ê³  ìš”ì¼ê³¼ êµì‹¤ì½”ë“œë¥¼ ì–‘ì‹ì— ë§ê²Œ ì…ë ¥í•´ì£¼ì„¸ìš”." + enteru + "\n\n" + "â„¹ë°©ë²•1â„¹\nì£¼ë§ì‹ ì²­ (ìš”ì¼)/(ë²ˆí˜¸1)/(ë²ˆí˜¸2)/....\nex) ì£¼ë§ì‹ ì²­ í† /1/2/3/4/5/6/7/8\n\nâ„¹ë°©ë²•2â„¹\nì£¼ë§ì‹ ì²­\n(ìš”ì¼)\n(êµì‹œë²ˆí˜¸): (êµì‹¤ë²ˆí˜¸) ì¤„ë°”ê¿ˆìœ¼ë¡œ êµ¬ë¶„í•˜ì—¬ ì…ë ¥.\n\nex)\nì£¼ë§ì‹ ì²­\ní† \n1: 5\n3: 1\n6: 0\n\nâ„¹ë°©ë²•3â„¹\nì£¼ë§ì‹ ì²­ (ìš”ì¼,êµì‹¤ì½”ë“œ,aë˜ëŠ”A)ë¥¼ ìˆœì„œ ìƒê´€ì—†ì´ ì…ë ¥\n-> ëª¨ë“  ììŠµì‹œê°„ì„ ë‹¨ì¼ êµì‹¤ë¡œ ì‹ ì²­.\nex) ì£¼ë§ì‹ ì²­ í† a20\n\nì‹ ì²­í•˜ì§€ ì•Šì„ ììŠµì‹œê°„ì€ ë¹ˆì¹¸ìœ¼ë¡œ í•´ì£¼ì„¸ìš”.\nì·¨ì†Œí•˜ì‹¤ ììŠµì‹œê°„ì—ëŠ” 0ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.\n\n" + "ğŸ”´ë´‡ìœ¼ë¡œ ììŠµì‹ ì²­ì„ í•˜ì—¬ ë°œìƒí•œ ë¬¸ì œëŠ” ê°œë°œìê°€ ì±…ì„ì§€ì§€ ì•Šìœ¼ë©° ì‚¬ìš©ì ë³¸ì¸ì—ê²Œ ì±…ì„ì´ ìˆìŠµë‹ˆë‹¤.\n\n" +  "====================\n\n" + sinfoa + iinfo + "\n\n\n" + sinfob + iiinfo);
        } else if ((msg.startsWith("ì£¼ë§ì¸ì›")) || (msg.startsWith("ì£¼ë§ ì¸ì›"))) {
          if (msg.indexOf("í† ") != -1) {
            var n = 0;
            var week = "í† ìš”ì¼";
          } else if (msg.indexOf("ì¼") != -1) {
            var n = 1;
            var week = "ì¼ìš”ì¼";
          } else {
            replier.reply("âš ï¸ì˜¬ë°”ë¥¸ ìš”ì¼ì„ í¬í•¨í•˜ì—¬ ë‹¤ì‹œ ì…ë ¥í•´ì£¼ì„¸ìš”.\nex) ì£¼ë§ì¸ì› í† ");
            return 0;
          }
          replier.reply("ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘.. (15ì´ˆ ì´ìƒ ì†Œìš”)");
          replier.reply("â„¹" + week + " ì£¼ë§ììŠµì¥ì†Œ ì¸ì›í˜„í™©â„¹" + enteru + "\n\n" + doWeekendCheckNum(n));
        } else if (msg.startsWith("ì£¼ë§ì‹ ì²­") || msg.startsWith("ì£¼ë§ ì‹ ì²­")) {
          if (!weekendUtil(room,msg, "CheckTime")) 
            return 0;
          else {
            replier.reply("ì‹ ì²­í•˜ëŠ” ì¤‘...\n(âš ï¸ì‹ ì²­ì´ ëë‚˜ê¸° ì „ê¹Œì§€ ììŠµì‹ ì²­ì„ ì ˆëŒ€ ì¬ì‹œë„ í•˜ì§€ ë§ì•„ì£¼ì„¸ìš”.)\nğŸ”´ë´‡ìœ¼ë¡œ ììŠµì‹ ì²­ì„ í•˜ì—¬ ë°œìƒí•œ ë¬¸ì œëŠ” ê°œë°œìê°€ ì±…ì„ì§€ì§€ ì•Šìœ¼ë©° ì‚¬ìš©ì ë³¸ì¸ì—ê²Œ ì±…ì„ì´ ìˆìŠµë‹ˆë‹¤.");
            var config = weekendUtil(room,msg, "SubmitConfig");
            if (!config) 
              return 0;
            var result = doWeekendCheck(true, false);
            var weeknum = result.split("var chk_week = \"")[1].split("\"")[0];
            var winfo = getFileParse(3);
            var i = 0;
            var pid = winfo[config.n].pid;
            var command = doWeekendConvert(config.command, config.n);
            result = result.split(config.str)[1].split(config.str2)[0].split("<th>");
            var stamp = result[7].split(config.weekind)[1].split("_")[1];
            var chkno = [];
            var dis = [];
            for (var i = 7; i < result.length; i++) {
              if (i % 2 == 1) {
                if (result[i].indexOf("ì·¨ì†Œ") != -1) 
                  dis.push("ì·¨ì†Œ");
                else 
                  dis.push("");
                var t2 = result[i].split("id=")[1].split(">")[0].split("_");
                chkno.push(t2[5]);
              }
            }
            for (var i = 0; i < pid.length; i++) {
              if (command[i + 1] == "" || command[i + 1] == undefined) 
                continue;
              if (dis[i] == "ì·¨ì†Œ" || command[i + 1] == "delete") 
                doWeekendSubmit("delete", chkno[i], pid[i], String(i + 1), stamp, config.weekind, weeknum, "");              //ì¼ë‹¨ ì·¨ì†Œ.
              if (command[i + 1] != "delete") 
                doWeekendSubmit("save", chkno[i], pid[i], String(i + 1), stamp, config.weekind, weeknum, command[i + 1]);              //ì·¨ì†Œê°€ ì•„ë‹ˆë©´ ì‹ ì²­.
            }
            replier.reply("ì‹ ì²­ ì™„ë£Œ!\n\n" + doWeekendCheck(false, true));
          }
        }
      }
    }    catch (error) {
  replier.reply("âš ï¸ì˜¤ë¥˜ ë°œìƒ!âš ï¸\n/ë¦¬ì…‹ ëª…ë ¹ì–´ë¥¼ ì‚¬ìš©í•œ ë’¤ ì¬ì‹œë„í•´ì£¼ì„¸ìš”!\nì˜¤ë¥˜ê°€ ê³„ì†ë˜ëŠ” ê²½ìš° ì—ëŸ¬ ë©”ì‹œì§€ë¥¼ ì°¸ê³ í•˜ì„¸ìš”.\n" + "Error Name: " + error.name + "\nError Message: " + error.message + "\nLine Number: " + error.lineNumber);
}
  }
}
function getToken() {
  //í† í°ê°’ì´ ìœ íš¨í•œì§€ í™•ì¸í•˜ê³  ìœ íš¨í•œ í† í°ê°’ì„ ë¦¬í„´í•¨.
  var arr = getUserInfo();  //ìœ ì €ì •ë³´ë¥¼ ë¡œì»¬ì—ì„œ ê°€ì ¸ì˜´.
  if (getName(arr[2]) == "") {
    //ì´ë¦„ì„ ì„œë²„ì—ì„œ ê°€ì ¸ì˜´. ì´ë¦„ì´ ë¹„ì–´ìˆìœ¼ë©´ í† í°ê°’ì´ ë¬´íš¨í•œê²ƒ.
    var temp = JSON.parse(FS.read(pathmain));
    temp.token = doLogin(arr);    //ì„œë²„ì— ìƒˆë¡œ ë¡œê·¸ì¸í•˜ì—¬ í† í°ê°’ì„ ê°€ì ¸ì˜¤ê³  ë¡œì»¬ì— ì €ì¥í•¨.
    FS.write(pathmain, JSON.stringify(temp, null, 4));
    return temp.token;
  } else {
    return arr[2];
  }
}
function getUserInfo() {
  //ìœ ì €ì •ë³´ë¥¼ ë¡œì»¬ì—ì„œ ê°€ì ¸ì™€ì„œ ë¦¬í„´í•¨.
  var list = JSON.parse(FS.read(pathmain));
  if (Object.keys(list).length == 0) 
    return false;
  return [list.ID, list.PW, list.token];
}
function getUserRegistered() {
  //ë¡œì»¬ì— ë“±ë¡ì´ ë˜ì–´ìˆëŠ”ì§€ í™•ì¸í•˜ê³  ë¦¬í„´í•¨.
  var list = JSON.parse(FS.read(pathmain));
  if (Object.keys(list).length == 0) 
    return false;
  else 
    return true;
}
function getName(token) {
  //ë°›ì€ í† í°ì„ ì‚¬ìš©í•´ ì„œë²„ì—ì„œ ì´ë¦„ì„ ê°€ì ¸ì˜¤ê³  ë¦¬í„´í•¨.
  try {
    var result = Jsoup.connect("https://djs.weschool.kr/sph_manager/prep/registration.php").header("Content-Type", "application/x-www-form-urlencoded").header("Cookie", token).ignoreContentType(true).ignoreHttpErrors(true).post().text();
  }  catch (error) {
  return "";
}
  try {
    var gotname = result.split("ê´€ë¦¬ ì‹œìŠ¤í…œ")[1].substr(15).split("(")[0].trim();
    return gotname;
  }  catch (error) {
  return "";
}
}
function isUser(element) {
  if (element.User == this) {
    return true;
  }
}
function isID(element) {
  if (element.ID == this) {
    return true;
  }
}
function doLogin(arr) {
  //ë°›ì€ ì•„ì´ë””, íŒ¨ìŠ¤ì›Œë“œë¡œ ë¡œê·¸ì¸í•˜ì—¬ ì„œë²„ì—ì„œ í† í°ê°’ì„ ìƒˆë¡œ ë°›ì•„ ë¦¬í„´í•¨.
  var ID = arr[0];
  var PW = arr[1];
  var result = Jsoup.connect("https://djs.weschool.kr/_login").header("Content-Type", "application/x-www-form-urlencoded").data("url", "/").data("UID", ID).data("PASSWD", PW).ignoreContentType(true).ignoreHttpErrors(true).method(org.jsoup.Connection.Method.POST).execute().cookies().get("COBEE_AUTH");
  result = JSON.stringify(result).replace("\"", "").replace("\"", "");
  return "COBEE_AUTH=" + result + ";Path=/;HttpOnly";
}
function doPointCheck() {
  //ë²Œì ì„ í™•ì¸í•¨.
  var token = getToken();
  var number= grade;
  var resultraw = Jsoup.connect("https://djs.weschool.kr/sph_manager/point/index.php?s_group=" + number).header("Content-Type", "application/x-www-form-urlencoded").header("Cookie", token).ignoreContentType(true).ignoreHttpErrors(true).post().text();
  var pTotal = resultraw.split("ëˆ„ì ì ìˆ˜ (")[1].split(")")[0];
  var pList = new Array();
  var pListRaw = resultraw.split("ëˆ„ì  ")[1];
  var result = "ë²Œì  ëª©ë¡ (í•©ê³„ " + pTotal + ")\n" + enteru + "\n";
  if (pListRaw != undefined) {
    pListRaw = pListRaw.split("2021-");
    pListRaw[1] = pListRaw[1].slice(0, -(pTotal.length) - 1);
    for (var i = 1; i <= pListRaw.length - 1; i++) 
      pList[pList.length] = pListRaw[i].replace("-", "/");
    for (var i = 1; i <= pListRaw.length - 1; i++) 
      result += pList[i - 1] + "\n";
  }
  return result;
}
function getWeekendTime() {
  var time = new Date();
  var yo = time.getDay();
  if (yo == 6 || yo == 0) 
    return true;
  else 
    return false;
}
function doSelfStudyCheckNum() {
  var token = getToken();
  var pnumbers = [];
  var pnumbertot = [];
  var pnames = [];
  var result = "";
  for (var n = 0; n < 3; n++) {
    pnumbers[n] = [];
    var resultraw = Jsoup.connect("https://djs.weschool.kr/sph_manager/prep/registration.php?mode=apply&order_no=" + (n + 1) + "&chk_no=").header("Content-Type", "application/x-www-form-urlencoded").header("Cookie", token).ignoreContentType(true).ignoreHttpErrors(true).post().text();
    result = resultraw.split("ì¢Œì„");
    for (var i = 2; i < result.length; i++) {
      temp = result[i].split(" ");
      pnumbers[n].push(temp[2].replace(/[(-)]/g, ""));
    }
  }
  for (var i = 2; i <= result.length; i++) {
    var temp = result[i - 1].split(" ");
    pnames.push(String(result[i - 2].substring(result[i - 2].indexOf(")") + 2, result[i - 2].length)));
    pnumbertot.push(temp[1]);
  }
  var res = "";
  for (var i = 6; i < pnumbertot.length; i++) 
    res += "(" + (i + 2) + ") " + pnames[i] + ": (" + pnumbers[0][i - 1] + "," + pnumbers[1][i - 1] + "," + pnumbers[2][i - 1] + "/" + pnumbertot[i] + ")\n\n";
  return res;
}
function doSelfStudySubmit(fid, num, m) {
  var token = getToken();
  if (m == "save") 
    Jsoup.connect("https://djs.weschool.kr/sph_manager/prep/registration.php").header("Content-Type", "application/x-www-form-urlencoded").header("Cookie", token).data("p_mode", "save").data("chk_mode", "seat_apply").data("chk_type", "seat").data("chk_no", "0").data("chk_fid", fid).data("chk_order_no", String(num)).ignoreContentType(true).ignoreHttpErrors(true).post();
  else 
    Jsoup.connect("https://djs.weschool.kr/sph_manager/prep/registration.php?mode=delete&order_no=" + num + "&chk_no=" + m).header("Content-Type", "application/x-www-form-urlencoded").header("Cookie", token).ignoreContentType(true).ignoreHttpErrors(true).get();
}
function getSelfStudyTime() {
  var time = new Date();
  var hour = time.getHours();
  var min = time.getMinutes();
  if ((hour < 18 && hour >= 8) || (hour == 18 && min < 30)) 
    return true;
  else 
    return false;
}
function doSelfStudyCheck(f1, f2) {
  var token = getToken();
  var result = Jsoup.connect("https://djs.weschool.kr/sph_manager/prep/registration.php").header("Content-Type", "application/x-www-form-urlencoded").header("Cookie", token).ignoreContentType(true).ignoreHttpErrors(true).post();
  try {
    if (f1 == true) {
      //ì·¨ì†Œìš© ì½”ë“œ ëŒë ¤ì£¼ê¸°
      var resultst = result.toString();
      var num = new Array();
      var tp = resultst.split("btn_app_1_")[1].split("\"");
      num.push(tp[0]);
      tp = resultst.split("btn_app_2_")[1].split("\"");
      num.push(tp[0]);
      tp = resultst.split("btn_app_3_")[1].split("\"");
      num.push(tp[0]);
      return num;
    }
    if (f2 == true) {
      //ì‹ ì²­ëª©ë¡ ëŒë ¤ì£¼ê¸°
      var resulttx = result.text();
      var J1 = resulttx.split("1 ììœ¨í•™ìŠµ ")[1].split(" 2 ììœ¨í•™ìŠµ")[0].replace("ì™„ë£Œ", "").replace("ì·¨ì†Œ", "").replace("ì‹ ì²­", "").replace("ìˆ˜ì •/", "").replace("ëŒ€ê¸°", "âš ï¸ëŒ€ê¸°");
      var J2 = resulttx.split("2 ììœ¨í•™ìŠµ ")[1].split(" 3 ììœ¨í•™ìŠµ")[0].replace("ì™„ë£Œ", "").replace("ì·¨ì†Œ", "").replace("ì‹ ì²­", "").replace("ìˆ˜ì •/", "").replace("ëŒ€ê¸°", "âš ï¸ëŒ€ê¸°");
      var J3 = resulttx.split("3 ììœ¨í•™ìŠµ ")[1].replace("ì™„ë£Œ", "").replace("ì·¨ì†Œ", "").replace("ì‹ ì²­", "").replace("ìˆ˜ì •/", "").replace("ëŒ€ê¸°", "âš ï¸ëŒ€ê¸°");
      if (J1 == "") 
        J1 = "(ì‹ ì²­ ì•ˆë¨)";
      if (J2 == "") 
        J2 = "(ì‹ ì²­ ì•ˆë¨)";
      if (J3 == "") 
        J3 = "(ì‹ ì²­ ì•ˆë¨)";
      var restring = "1ì: " + J1 + "\n2ì: " + J2 + "\n3ì: " + J3;
      return restring;
    }
  }  catch (error) {
  return doSelfStudyCheck(f1, f2);
}
}
function doSelfStudyConvert(arr) {
  var convert = getFileParse(4);
  for (var i = 0; i < 3; i++) {
    if (arr[i] == undefined) 
      arr[i] = "";
    if (arr[i] != "") 
      arr[i] = convert[Number(arr[i])];
  }
  return arr;
}
function doSelfStudyNameConvert(arr, number) {
  var names = getRoomNumberList(number, 0);
  return [names[Number(arr[0])], names[Number(arr[1])], names[Number(arr[2])]];
}
function weekendUtil(sender,msg, type) {
  if (msg.indexOf("í† ") != -1) var n = 0;
  else if (msg.indexOf("ì¼") != -1) var n = 1;
  else {Api.replyRoom(sender,"âš ï¸ìš”ì¼ì„ í¬í•¨í•˜ì—¬ ë‹¤ì‹œ ì…ë ¥í•´ì£¼ì„¸ìš”."); return false;}
  if (type == "CheckTime") {
    if (n == 0) {
      if (getWeekendSatTime()) return true;
      else {Api.replyRoom(sender, "â›”ì‹ ì²­ ì‹œê°„ì´ ì•„ë‹™ë‹ˆë‹¤."); return false;}
    } else if (n == 1) {
      if (getWeekendSatTime()) return true;
      else {Api.replyRoom(sender, "â›”ì‹ ì²­ ì‹œê°„ì´ ì•„ë‹™ë‹ˆë‹¤."); return false;}
    }
  } else if (type == "CheckStatus") {
    if (n == 0) 
      return {n: 0, week: "í† ìš”ì¼"};
    else if (n == 1) 
      return {n: 1, week: "ì¼ìš”ì¼"};
  } else if (type == "SubmitConfig") {
    if (msg.substr(5).indexOf("a") != -1 || msg.substr(5).indexOf("A") != -1) {
      var tp = msg.substr(5).replace(/A|a|í† |ì¼|ê³µ/g, "");
      var command = ["a", tp, tp, tp, tp, tp, tp, tp, tp];
      if (n == 0) 
        return {n: 0, weekind: "saturday", str: "<!-- í† ìš”ì¼ ë°©ê³¼í›„ í”„ë¡œê·¸ë¨ ì‹ ì²­ --> ", str2: "<!-- í† ìš”ì¼ ë°©ê³¼í›„ ë --> ", command: command};
      if (n == 1) 
        return {n: 1, weekind: "sunday", str: "<!-- ì¼ìš”ì¼ ë°©ê³¼í›„ í”„ë¡œê·¸ë¨ ì‹ ì²­ --> ", str2: "<!-- ì¼ìš”ì¼ ë°©ê³¼í›„ ë --> ", command: command};
    }
    var command1 = msg.substr(5).split("/");
    var command2 = msg.split("\n");
    if (command2[1] == undefined && command1[1] != undefined) {
      if (n == 0) 
        return  {n: 0, weekind: "saturday", str: "<!-- í† ìš”ì¼ ë°©ê³¼í›„ í”„ë¡œê·¸ë¨ ì‹ ì²­ --> ", str2: "<!-- í† ìš”ì¼ ë°©ê³¼í›„ ë --> ", command: command1};
      if (n == 1) 
        return {n: 1, weekind: "sunday", str: "<!-- ì¼ìš”ì¼ ë°©ê³¼í›„ í”„ë¡œê·¸ë¨ ì‹ ì²­ --> ", str2: "<!-- ì¼ìš”ì¼ ë°©ê³¼í›„ ë --> ", command: command1};
    } else if (command2[1] != undefined && command1[1] == undefined) {
      var command = [, , , , , , , , ,];
      for (var ik = 2; ik < command2.length; ik++) {
        var tmp = command2[ik].split(":");
        command[Number(tmp[0])] = tmp[1];
      }
      if (n == 0) 
        return {n: 0, weekind: "saturday", str: "<!-- í† ìš”ì¼ ë°©ê³¼í›„ í”„ë¡œê·¸ë¨ ì‹ ì²­ --> ", str2: "<!-- í† ìš”ì¼ ë°©ê³¼í›„ ë --> ", command: command};
      if (n == 1) 
        return {n: 1, weekind: "sunday", str: "<!-- ì¼ìš”ì¼ ë°©ê³¼í›„ í”„ë¡œê·¸ë¨ ì‹ ì²­ --> ", str2: "<!-- ì¼ìš”ì¼ ë°©ê³¼í›„ ë --> ", command: command};
    } else {
      Api.replyRoom(sender, "âš ï¸ì…ë ¥ì´ ì˜ëª»ë˜ì—ˆìŠµë‹ˆë‹¤. í˜•ì‹ì— ë§ê²Œ ë‹¤ì‹œ ì…ë ¥í•´ì£¼ì„¸ìš”.");
      return false;
    }
  }
}
function doWeekendCheckNum(n) {
  var token = getToken();
  var result = doWeekendCheck(true, false);
  var weeknum = result.split("var chk_week = \"")[1].split("\"")[0];
  var winfo = getFileParse(3);
  var str = ["<!-- í† ìš”ì¼ ë°©ê³¼í›„ í”„ë¡œê·¸ë¨ ì‹ ì²­ --> ", "<!-- ì¼ìš”ì¼ ë°©ê³¼í›„ í”„ë¡œê·¸ë¨ ì‹ ì²­ --> ", "<!-- ê³µíœ´ì¼ ë°©ê³¼í›„ í”„ë¡œê·¸ë¨ ì‹ ì²­ --> "];
  var str2 = ["<!-- í† ìš”ì¼ ë°©ê³¼í›„ ë --> ", "<!-- ì¼ìš”ì¼ ë°©ê³¼í›„ ë --> ", "<!-- ì£¼ë§ ë°©ê³¼í›„ ë --> "];
  var str3 = ["saturday", "sunday"];
  var i = 0;
  var pid = winfo[n].pid;
  var weekind = str3[n];
  resultm = result.split(str[n])[1].split(str2[n])[0].split("<th>");
  var stamp = resultm[7].split(weekind)[1].split("_")[1];
  var chkno = [];
  var pnumbers = [];
  for (var i = 7; i < resultm.length; i++) {
    if (i % 2 == 1) {
      var t2 = resultm[i].split("id=")[1].split(">")[0].split("_");
      chkno.push(t2[5]);
    }
  }
  for (var i = 0; i < pid.length; i++) {
    pnumbers.push(doWeekendLoadNum(chkno[i], pid[i], String(i + 1), stamp, weekind, weeknum, "", token));
  }
  var names = getFileParse(n + 1);
  var pnumbertot = doWeekendLoadNum(chkno[0], pid[0], 1, stamp, weekind, weeknum, "tot", token);
  var res = "";
  for (var i = 6; i < pnumbertot.length; i++) {
    res += "(" + (i + 2) + ") " + names[i + 2] + ":\n\t=> ";
    for (var j = 0; j < pnumbers.length; j++) {
      res += pnumbers[j][i - 1];
      if (j == 0 || j == pnumbers.length - 4) 
        res += '|';
      else 
        res += ',';
    }
    res = res.substr(0, res.length - 1);
    res += " (ì •ì›: " + pnumbertot[i] + ") \n\n";
  }
  return res;
}
function doWeekendLoadNum(chkno, pid, orderno, stamp, kind, chkweek, flag, token) {
  var resultraw = Jsoup.connect("https://djs.weschool.kr/sph_manager/weekend/index.php?mode=layer_apply&kind=" + kind + "&stamp=" + stamp + "&order_no=" + orderno + "&chk_no=" + chkno + "&chk_week=" + chkweek + "&pid=" + pid).header("Content-Type", "application/x-www-form-urlencoded").header("Cookie", token).ignoreContentType(true).ignoreHttpErrors(true).get().text();
  result = resultraw.split("ì¢Œì„");
  if (flag == 'tot') {
    var pnumbertot = [];
    for (var i = 2; i <= result.length; i++) {
      var temp = result[i - 1].split(" ");
      pnumbertot.push(temp[1]);
    }
    return pnumbertot;
  } else {
    var pnumber = [];
    for (var i = 2; i < result.length; i++) {
      temp = result[i].split(" ");
      pnumber.push(temp[2].replace(/[(-)]/g, ""));
    }
    return pnumber;
  }
}
function doWeekendCheck(f1, f2) {
  var token = getToken();
  var result = Jsoup.connect("https://djs.weschool.kr/sph_manager/weekend/index.php").header("Content-Type", "application/x-www-form-urlencoded").header("Cookie", token).ignoreContentType(true).ignoreHttpErrors(true).post();
  if (f1 == true) {
    return result.toString();
  } else if (f2 == true) {
    result = result.text().replace("(1ì¸1ê¸° 1,2í•™ë…„)", "").replace(/\(ì£¼ë§í”„ë¡œê·¸ë¨\)/g, "").replace(/ ììœ¨í•™ìŠµ/g, " ììœ¨").replace("ììœ¨í•™ìŠµ", " ììœ¨").replace(/\(2í•™ë…„\)/, "");
    var J1 = "";
    if (result.split("ê³µíœ´ì¼")[1] != undefined) 
      J1 = "<ê³µíœ´ì¼>\n " + result.split("ê³µíœ´ì¼")[1].split("í† ìš”ì¼")[0].substr(94).replace(/ì™„ë£Œ/g, "").replace(/ì·¨ì†Œ/g, "\n").replace(/ì‹ ì²­/g, "\n") + "\n";
    var J2 = result.split("í† ìš”ì¼")[1].split("ì¼ìš”ì¼")[0].substr(94).replace(/ì™„ë£Œ/g, "").replace(/ì·¨ì†Œ/g, "\n").replace(/ì‹ ì²­/g, "\n").replace("ì˜¤ì „ ììœ¨", "ì˜¤ì „ ììœ¨  ").replace("ê¿ˆì§€ë½", "ê¿ˆì§€ë½      ");
    var J3 = result.split("ì¼ìš”ì¼")[1].replace(/ì™„ë£Œ/g, "").substr(91).replace(/ì·¨ì†Œ/g, "\n").replace(/ì‹ ì²­/g, "\n").replace("ì˜¤ì „ ììœ¨", "ì˜¤ì „ ììœ¨  ");
    return J1 + "<í† ìš”ì¼>\n " + J2 + "\n<ì¼ìš”ì¼>\n" + J3;
  }
}
function doWeekendSubmit(mode, chkno, pid, orderno, stamp, kind, chkweek, fid) {
  var token = getToken();
  if (mode == "delete") {
    Jsoup.connect("https://djs.weschool.kr/sph_manager/weekend/index.php?mode=" + mode + "&kind=" + kind + "&stamp=" + stamp + "&order_no=" + orderno + "&chk_no=" + chkno + "&chk_week=" + chkweek + "&pid=" + pid).header("Content-Type", "application/x-www-form-urlencoded").header("Cookie", token).ignoreContentType(true).ignoreHttpErrors(true).post();
  } else if (mode == "save") {
    Jsoup.connect("https://djs.weschool.kr/sph_manager/weekend/index.php").header("Content-Type", "application/x-www-form-urlencoded").header("Cookie", token).data("chk_mode", "layer_seat_apply").data("chk_type", "seat").data("p_mode", "save").data("kind", kind).data("chk_no", chkno).data("chk_week", chkweek).data("pid", pid).data("chk_fid", fid).data("chk_order_no", orderno).data("stamp", stamp).ignoreContentType(true).ignoreHttpErrors(true).post();
  }
}
function doWeekendConvert(qarr, qn) {
  var qconvert = getFileParse(3);
  for (var qi = 1; qi < qarr.length; qi++) {
    if (qarr[qi] != "") 
      qarr[qi] = qconvert[qn].fid[Number(qarr[qi])];
  }
  return qarr;
}
function doWeekendNameConvert(arr, number, n, preset) {
  var result = [""];
  var names = getFileParse(number, n + 1);
  for (var i = 1; i < arr.length; i++) {
    if (arr[i] == "" || arr[i] == undefined || arr[i] == "0") {
      if (arr[i] == "0" || preset == undefined || preset[i] == undefined) 
        result.push("(ì„¤ì • ì•ˆë¨)");
      else 
        result.push(preset[i]);
    } else 
      result.push(names[Number(arr[i])]);
    if (result[i - 1] == undefined) 
      return "nope";
  }
  return result;
}
function getWeekendSatTime() {
  var time = new Date();
  var hour = time.getHours();
  var yo = time.getDay();
  if (((yo == 5) && (hour >= 22)) || yo == 6) 
    return false;
  else 
    return true;
}
function getWeekendSunTime() {
  var time = new Date();
  var hour = time.getHours();
  var yo = time.getDay();
  if ((yo == 6) && (hour >= 22) || yo == 0) 
    return false;
  else 
    return true;
}
function format(st, names) {
  return st.replace(/\{(\d+)\}/g, function(match, num) {
  return " " + names[num];
});
}
function getFileParse(type) {
  var filename = ["selfstudy_weekday_namelist.txt", "selfstudy_sat_namelist.txt", "selfstudy_sun_namelist.txt", "weekenddb.txt", "weekdaydb.txt"];
  var path = "/sdcard/messengerbot/dshs/" + grade + "/" + filename[type];
  return JSON.parse(FS.read(path));
}
function getRoomNumberList(type) {
  var db = getFileParse(type);
  var result = "";
  for (var i = 1; i < db.length; i++) {
    result += "(" + i + ")" + " " + db[i] + "\n";
  }
  return result;
}









function getWeekendDB(n) {
  var token = getToken();
  var result = doWeekendCheck(true, false);
  var weeknum = result.split("var chk_week = \"")[1].split("\"")[0];
  var winfo = getFileParse(3);
  var str = ["<!-- í† ìš”ì¼ ë°©ê³¼í›„ í”„ë¡œê·¸ë¨ ì‹ ì²­ --> ", "<!-- ì¼ìš”ì¼ ë°©ê³¼í›„ í”„ë¡œê·¸ë¨ ì‹ ì²­ --> ", "<!-- ê³µíœ´ì¼ ë°©ê³¼í›„ í”„ë¡œê·¸ë¨ ì‹ ì²­ --> "];
  var str2 = ["<!-- í† ìš”ì¼ ë°©ê³¼í›„ ë --> ", "<!-- ì¼ìš”ì¼ ë°©ê³¼í›„ ë --> ", "<!-- ì£¼ë§ ë°©ê³¼í›„ ë --> "];
  var str3 = ["saturday", "sunday"];
  var i = 0;
  var pid = winfo[n].pid;
  var weekind = str3[n];
  resultm = result.split(str[n])[1].split(str2[n])[0].split("<th>");
  var stamp = resultm[7].split(weekind)[1].split("_")[1];
  var chkno = [];
  var pnumbers = [];
  for (var i = 7; i < resultm.length; i++) {
    if (i % 2 == 1) {
      var t2 = resultm[i].split("id=")[1].split(">")[0].split("_");
      chkno.push(t2[5]);
    }
  }
  return getWeekendDBcon(chkno[i], pid[i], "1", stamp, weekind, weeknum, "", token);
  
}
function getWeekendDBcon(chkno, pid, orderno, stamp, kind, chkweek, flag, token) {
  var resultraw = Jsoup.connect("https://djs.weschool.kr/sph_manager/weekend/index.php?mode=layer_apply&kind=" + kind + "&stamp=" + stamp + "&order_no=" + orderno + "&chk_no=" + chkno + "&chk_week=" + chkweek + "&pid=" + pid).header("Content-Type", "application/x-www-form-urlencoded").header("Cookie", token).ignoreContentType(true).ignoreHttpErrors(true).get();
  result=resultraw.toString();
  arr=result.split("<th>");
  var namelist=[];
  var pidlist=["delete"];
  for(var i=9;i<arr.length;i++){
    namelist.push(arr[i].split("</th>")[0].replace("amp;",""));
    pidlist.push(arr[i].split("id=\"")[1].split("\"")[0]);
  }
  return String(namelist)+"\n\n"+String(pidlist);
}






